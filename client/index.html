<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN">
<html>
  <head>
    <meta http-equiv="Content-type" content="text/html; charset=utf-8">
    <title>
      CollabCoding
    </title>
    <link rel="stylesheet" href="assets/css/bootstrap.min.css" type="text/css" media="screen" charset="utf-8">
    <link rel="stylesheet" href="assets/css/jquery.treeview.css" type="text/css" media="screen" charset="utf-8">
    <link rel="stylesheet" href="assets/css/smoothness/jquery-ui-1.8.22.custom.css" type="text/css" media="screen" charset="utf-8">
    <link rel="stylesheet" href="assets/css/site.css" type="text/css" media="screen" charset="utf-8">
    <script type="text/javascript" charset="utf-8" src="assets/js/jquery-1.7.2.min.js"></script>
    <script type="text/javascript" charset="utf-8" src="assets/js/jquery-ui-1.8.21.custom.min.js"></script>
    <script type="text/javascript" charset="utf-8" src="assets/js/bootstrap.min.js"></script>
    <script type="text/javascript" charset="utf-8" src="assets/js/jquery.treeview.js"></script>
    <script type="text/javascript" charset="utf-8" src="assets/js/ace/ace.js"></script>
    <script type="text/javascript" charset="utf-8" src="assets/js/ace/mode-javascript.js"></script>
    <script type="text/javascript" charset="utf-8" src="assets/js/ace/mode-html.js"></script>
    <script type="text/javascript" charset="utf-8" src="assets/js/ace/mode-css.js"></script>    
    <script type="text/javascript" src="assets/js/ace/mode-coffee.js"></script>
    <script type="text/javascript" src="assets/js/ace/theme-chrome.js"></script>    
    <script type="text/javascript" src="/channel/bcsocket.js"></script>
    <script type="text/javascript" src="/share/share.js"></script>
    <script type="text/javascript" src="/share/ace.js"></script>
    <style type="text/css" media="screen">
		#tabs {
			padding: 0;
			width: 100%;
			height: 100%;
		}
		#editor {
			padding: 0;
			width: 100%;
			height: 750px;
		}

    </style>
    <script type="text/javascript" charset="utf-8">
		var randomDocName = function(length) {
			var chars, x;
			if (length == null) {
				length = 10;
			}
			chars = "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789-=";
			var name = [];
			for ( x = 0; x < length; x++) {
				name.push(chars[Math.floor(Math.random() * chars.length)]);
			}
			return name.join('');
		};

		$(document).ready(function() {
			$("#project-tree").treeview();
			$("#nav-tabs").tabs();
			$("#tabs").tabs();

			$("#new").bind('click', function() {
				console.log("click");
      });
      // layout
      _height = document.documentElement.clientHeight - $(".navbar").height() - 40;
      $("#editor-area").height(_height);
      $("#nav-tabs").height(_height);


			// set up ace and sharejs
			var editor = ace.edit("editor");
			editor.resize()
			var JavaScriptMode = require("ace/mode/javascript").Mode;
			editor.getSession().setMode(new JavaScriptMode());
			editor.setReadOnly(true);
//			editor.setTheme("ace/theme/chrome");
      editor.setTheme("ace/theme/idle_fingers");

			var docName;
			if (!document.location.hash) {
				docName = '#' + randomDocName();
			} else {
				docName = document.location.hash;
			}
			sharejs.open(docName, 'text', function(error, doc) {
				if (error) {
					console.error(error);
					return;
				};

				doc.attach_ace(editor);
				editor.setReadOnly(false);
			});
			// binding event
			$("#shareDoc").click(function() {
				$("#dialog").attr('title', 'Share via this link');				
				var dialogContent = "<table style='width:100%'><tr><td>" + document.location + docName + "</td><tr><td><input id='collaboratorEmail' style='width:100%; margin:5px 0px 5px 0px' type='email' placeholder='Enter a valid email address'></input></td></tr><tr><td align='center'><button role='button' id='shareDocOrig' style='margin:5px 0px 5px 0px' class='ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only'><span class='ui-button-text'>Share</span></button></td></tr></table>";
				$("#dialog").html(dialogContent);
				//$("#dialog").dialog();
				$("#dialog").dialog({					
					show: "blind",
					hide: "explode",
					position: "top"									
				});				
			});
		});

    </script>
  </head>
  <body style="font-family:'Lucida Grande', sans-serif; font-size:75%;">
    <!-- Info Bar -->
    <div class="navbar" style="margin-bottom: 0">
      <div class="navbar-inner" style="background-image: transparent">
        <div class="container">
          <div class="nav-collapse collapse">
               <button title="Share via email" id="shareDoc" style="position: absolute;margin-top:5px;" class="ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only"><span class="ui-button-text">ShareIcon</span></button>    
                  <div id="dialog" style="display:none">                 		
                  </div>              
              <div style="text-align:center; padding-top: 10px;">Tool</div>
          </div>
        </div>
      </div>
    </div>
    <div class="container-fluid">
      <div class="row-fluid">
        <div class="span2" id="left-items">
          <div id="nav-tabs">
          <ul>
            <li><a href="#project">Project</a></li>
            <li><a href="#chat">Chat</a></li>
          </ul>
          <div id="project">
            <ul id="project-tree" class="filetree">
              <li>
                <span class="folder">Folder 1</span>
                <ul>
                  <li>
                    <span class="file">Item 1.1</span>
                  </li>
                </ul>
              </li>
              <li>
                <span class="folder">Folder 2</span>
                <ul>
                  <li>
                    <span class="folder">Subfolder 2.1</span>
                    <ul id="folder21">
                      <li>
                        <span class="file">File 2.1.1</span>
                      </li>
                      <li>
                        <span class="file">File 2.1.2</span>
                      </li>
                    </ul>
                  </li>
                  <li>
                    <span class="file">File 2.2</span>
                  </li>
                </ul>
              </li>
              <li class="closed">
                <span class="folder">Folder 3 (closed at start)</span>
                <ul>
                  <li>
                    <span class="file">File 3.1</span>
                  </li>
                </ul>
              </li>
              <li>
                <span class="file">File 4</span>
              </li>
            </ul>
          </div><!-- <a href="#" id="hide-left" style="position: absolute;float: right">
            <img src="assets/img/left-btn.png">
          </a> -->
          <div id="chat" >                 
            blah!blah!blah!
          </div>
        </div>
        </div>
        <div class="span8" id="editor-area">
          <div id="tabs">
            <ul>
              <li>
                <a href="#editor">Untitled</a>
              </li>
              <li style="cursor: pointer;">
                <a href="#new">+</a>
              </li>
            </ul>
            <div id="editor"></div>
          </div>
        </div>
        <div class="span2" style="height: 800px; margin: 0;">
          <div id="comment" style="margin-left: 10px; -webkit-border-radius: 4px;border: 1px solid #AAA; margin-top:60px;">
            <div  style="background-color: #FFFFFF;">
              <div style="padding: 5px">
                <img src="assets/img/silhouette.png" height="24" width="24" alt="" style="position: absolute">
                <div style="font-size: 12px; font-weight: bold; margin-left: 32px;">
                  Charlie
                </div>
                <div style="margin: 3px 0 0 32px;font-size: 11px;color: #666;">
                  4:55 PM Today
                </div>
                <div style="color: black; margin: auto;">
                  test test test test
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </body>
</html>
